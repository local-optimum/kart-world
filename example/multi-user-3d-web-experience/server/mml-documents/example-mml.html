<!-- <m-group id="stairs" z="10" y="0.1"></m-group> -->

<!-- Race Track Environment -->
<m-model 
  id="racetrack" 
  src="https://mmlstorage.com/3a26161fadce611cc9f55ae5ff56edc7052ace05622e9468bef11a747851a5b4"
  x="-235.366" 
  y="18.59" 
  z="44.947"
  rx="0"
  ry="0" 
  rz="0"
  sx="0.1"
  sy="0.1"
  sz="0.1"
  collision-interval="100"
></m-model>

<!-- Multiple Climate Trees -->
<!-- Tree 1 -->
<m-group id="tree-group-1" x="8" y="1.5" z="12">
  <m-model 
    id="cartoon-tree-1"
    src="https://mmlstorage.com/b58aebd0e8e13fee1d5e99012ee1ed53bbf2e40631a90a1353317b2be12c7d9a" 
    x="0" y="-2" z="0" sx="0.005" sy="0.005" sz="0.005"
  ></m-model>

  <!-- Warning Labels -->
  <m-label id="tree-warning-label-1-0" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="0"></m-label>
  <m-label id="tree-warning-label-1-90" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="90"></m-label>
  <m-label id="tree-warning-label-1-180" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="180"></m-label>
  <m-label id="tree-warning-label-1-270" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="270"></m-label>

  <!-- Despawn Labels -->
  <m-label id="tree-despawn-label-1-0" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="0"></m-label>
  <m-label id="tree-despawn-label-1-90" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="90"></m-label>
  <m-label id="tree-despawn-label-1-180" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="180"></m-label>
  <m-label id="tree-despawn-label-1-270" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="270"></m-label>

  <m-position-probe id="tree-probe-1" range="5" interval="100" debug="false"></m-position-probe>
  <m-audio id="tree-audio-1" src="https://mmlstorage.com/be4d3efc7975d562bd0c62075b00b3f0998d1778d795e675186516d9a2804610" volume="0.8" loop="false" enabled="true"></m-audio>
</m-group>

<!-- Tree 2 -->
<m-group id="tree-group-2" x="-15" y="1.5" z="-8">
  <m-model 
    id="cartoon-tree-2"
    src="https://mmlstorage.com/b58aebd0e8e13fee1d5e99012ee1ed53bbf2e40631a90a1353317b2be12c7d9a" 
    x="0" y="-2" z="0" sx="0.005" sy="0.005" sz="0.005"
  ></m-model>

  <!-- Warning Labels -->
  <m-label id="tree-warning-label-2-0" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="0"></m-label>
  <m-label id="tree-warning-label-2-90" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="90"></m-label>
  <m-label id="tree-warning-label-2-180" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="180"></m-label>
  <m-label id="tree-warning-label-2-270" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="270"></m-label>

  <!-- Despawn Labels -->
  <m-label id="tree-despawn-label-2-0" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="0"></m-label>
  <m-label id="tree-despawn-label-2-90" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="90"></m-label>
  <m-label id="tree-despawn-label-2-180" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="180"></m-label>
  <m-label id="tree-despawn-label-2-270" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="270"></m-label>

  <m-position-probe id="tree-probe-2" range="5" interval="100" debug="false"></m-position-probe>
  <m-audio id="tree-audio-2" src="https://mmlstorage.com/be4d3efc7975d562bd0c62075b00b3f0998d1778d795e675186516d9a2804610" volume="0.8" loop="false" enabled="true"></m-audio>
</m-group>

<!-- Tree 3 -->
<m-group id="tree-group-3" x="22" y="1.5" z="-18">
  <m-model 
    id="cartoon-tree-3"
    src="https://mmlstorage.com/b58aebd0e8e13fee1d5e99012ee1ed53bbf2e40631a90a1353317b2be12c7d9a" 
    x="0" y="-2" z="0" sx="0.005" sy="0.005" sz="0.005"
  ></m-model>

  <!-- Warning Labels -->
  <m-label id="tree-warning-label-3-0" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="0"></m-label>
  <m-label id="tree-warning-label-3-90" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="90"></m-label>
  <m-label id="tree-warning-label-3-180" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="180"></m-label>
  <m-label id="tree-warning-label-3-270" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="270"></m-label>

  <!-- Despawn Labels -->
  <m-label id="tree-despawn-label-3-0" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="0"></m-label>
  <m-label id="tree-despawn-label-3-90" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="90"></m-label>
  <m-label id="tree-despawn-label-3-180" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="180"></m-label>
  <m-label id="tree-despawn-label-3-270" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="270"></m-label>

  <m-position-probe id="tree-probe-3" range="5" interval="100" debug="false"></m-position-probe>
  <m-audio id="tree-audio-3" src="https://mmlstorage.com/be4d3efc7975d562bd0c62075b00b3f0998d1778d795e675186516d9a2804610" volume="0.8" loop="false" enabled="true"></m-audio>
</m-group>

<!-- Tree 4 -->
<m-group id="tree-group-4" x="-25" y="1.5" z="15">
  <m-model 
    id="cartoon-tree-4"
    src="https://mmlstorage.com/b58aebd0e8e13fee1d5e99012ee1ed53bbf2e40631a90a1353317b2be12c7d9a" 
    x="0" y="-2" z="0" sx="0.005" sy="0.005" sz="0.005"
  ></m-model>

  <!-- Warning Labels -->
  <m-label id="tree-warning-label-4-0" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="0"></m-label>
  <m-label id="tree-warning-label-4-90" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="90"></m-label>
  <m-label id="tree-warning-label-4-180" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="180"></m-label>
  <m-label id="tree-warning-label-4-270" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="270"></m-label>

  <!-- Despawn Labels -->
  <m-label id="tree-despawn-label-4-0" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="0"></m-label>
  <m-label id="tree-despawn-label-4-90" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="90"></m-label>
  <m-label id="tree-despawn-label-4-180" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="180"></m-label>
  <m-label id="tree-despawn-label-4-270" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="270"></m-label>

  <m-position-probe id="tree-probe-4" range="5" interval="100" debug="false"></m-position-probe>
  <m-audio id="tree-audio-4" src="https://mmlstorage.com/be4d3efc7975d562bd0c62075b00b3f0998d1778d795e675186516d9a2804610" volume="0.8" loop="false" enabled="true"></m-audio>
</m-group>

<!-- Tree 5 -->
<m-group id="tree-group-5" x="5" y="1.5" z="-25">
  <m-model 
    id="cartoon-tree-5"
    src="https://mmlstorage.com/b58aebd0e8e13fee1d5e99012ee1ed53bbf2e40631a90a1353317b2be12c7d9a" 
    x="0" y="-2" z="0" sx="0.005" sy="0.005" sz="0.005"
  ></m-model>

  <!-- Warning Labels -->
  <m-label id="tree-warning-label-5-0" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="0"></m-label>
  <m-label id="tree-warning-label-5-90" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="90"></m-label>
  <m-label id="tree-warning-label-5-180" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="180"></m-label>
  <m-label id="tree-warning-label-5-270" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="270"></m-label>

  <!-- Despawn Labels -->
  <m-label id="tree-despawn-label-5-0" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="0"></m-label>
  <m-label id="tree-despawn-label-5-90" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="90"></m-label>
  <m-label id="tree-despawn-label-5-180" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="180"></m-label>
  <m-label id="tree-despawn-label-5-270" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="270"></m-label>

  <m-position-probe id="tree-probe-5" range="5" interval="100" debug="false"></m-position-probe>
  <m-audio id="tree-audio-5" src="https://mmlstorage.com/be4d3efc7975d562bd0c62075b00b3f0998d1778d795e675186516d9a2804610" volume="0.8" loop="false" enabled="true"></m-audio>
</m-group>

<!-- Tree 6 -->
<m-group id="tree-group-6" x="-5" y="1.5" z="25">
  <m-model 
    id="cartoon-tree-6"
    src="https://mmlstorage.com/b58aebd0e8e13fee1d5e99012ee1ed53bbf2e40631a90a1353317b2be12c7d9a" 
    x="0" y="-2" z="0" sx="0.005" sy="0.005" sz="0.005"
  ></m-model>

  <!-- Warning Labels -->
  <m-label id="tree-warning-label-6-0" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="0"></m-label>
  <m-label id="tree-warning-label-6-90" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="90"></m-label>
  <m-label id="tree-warning-label-6-180" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="180"></m-label>
  <m-label id="tree-warning-label-6-270" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="270"></m-label>

  <!-- Despawn Labels -->
  <m-label id="tree-despawn-label-6-0" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="0"></m-label>
  <m-label id="tree-despawn-label-6-90" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="90"></m-label>
  <m-label id="tree-despawn-label-6-180" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="180"></m-label>
  <m-label id="tree-despawn-label-6-270" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="270"></m-label>

  <m-position-probe id="tree-probe-6" range="5" interval="100" debug="false"></m-position-probe>
  <m-audio id="tree-audio-6" src="https://mmlstorage.com/be4d3efc7975d562bd0c62075b00b3f0998d1778d795e675186516d9a2804610" volume="0.8" loop="false" enabled="true"></m-audio>
</m-group>

<!-- Tree 7 -->
<m-group id="tree-group-7" x="30" y="1.5" z="8">
  <m-model 
    id="cartoon-tree-7"
    src="https://mmlstorage.com/b58aebd0e8e13fee1d5e99012ee1ed53bbf2e40631a90a1353317b2be12c7d9a" 
    x="0" y="-2" z="0" sx="0.005" sy="0.005" sz="0.005"
  ></m-model>

  <!-- Warning Labels -->
  <m-label id="tree-warning-label-7-0" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="0"></m-label>
  <m-label id="tree-warning-label-7-90" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="90"></m-label>
  <m-label id="tree-warning-label-7-180" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="180"></m-label>
  <m-label id="tree-warning-label-7-270" content="DO NOT HIT THIS TREE" font-size="100" font-color="red" alignment="center" y="7" width="12" height="1.5" emissive="0" visible="true" collide="false" color="rgb(0,0,0)" ry="270"></m-label>

  <!-- Despawn Labels -->
  <m-label id="tree-despawn-label-7-0" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="0"></m-label>
  <m-label id="tree-despawn-label-7-90" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="90"></m-label>
  <m-label id="tree-despawn-label-7-180" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="180"></m-label>
  <m-label id="tree-despawn-label-7-270" content="RIP ENVIRONMENT" font-size="80" font-color="green" alignment="center" y="2" width="9" height="1" emissive="0.5" color="rgb(0,0,0)" visible="false" collide="false" ry="270"></m-label>

  <m-position-probe id="tree-probe-7" range="5" interval="100" debug="false"></m-position-probe>
  <m-audio id="tree-audio-7" src="https://mmlstorage.com/be4d3efc7975d562bd0c62075b00b3f0998d1778d795e675186516d9a2804610" volume="0.8" loop="false" enabled="true"></m-audio>
</m-group>

<!-- Map-wide position probe for tracking all players -->
<m-position-probe 
  id="player-tracker" 
  range="1000" 
  interval="16"
  debug="false"
  x="0"
  y="0"
  z="0"
></m-position-probe>

<!-- Container for dynamic player labels -->
<m-group id="player-labels-container"></m-group>

<!-- Container for dynamic player car audio -->
<m-group id="player-audio-container"></m-group>

<script>
  // Multiple tree system
  const trees = [
    {
      id: 1,
      group: document.getElementById("tree-group-1"),
      model: document.getElementById("cartoon-tree-1"),
      probe: document.getElementById("tree-probe-1"),
      audio: document.getElementById("tree-audio-1"),
      warningLabels: [
        document.getElementById("tree-warning-label-1-0"),
        document.getElementById("tree-warning-label-1-90"),
        document.getElementById("tree-warning-label-1-180"),
        document.getElementById("tree-warning-label-1-270")
      ],
      despawnLabels: [
        document.getElementById("tree-despawn-label-1-0"),
        document.getElementById("tree-despawn-label-1-90"),
        document.getElementById("tree-despawn-label-1-180"),
        document.getElementById("tree-despawn-label-1-270")
      ],
      collected: false,
      hitBy: null
    },
    {
      id: 2,
      group: document.getElementById("tree-group-2"),
      model: document.getElementById("cartoon-tree-2"),
      probe: document.getElementById("tree-probe-2"),
      audio: document.getElementById("tree-audio-2"),
      warningLabels: [
        document.getElementById("tree-warning-label-2-0"),
        document.getElementById("tree-warning-label-2-90"),
        document.getElementById("tree-warning-label-2-180"),
        document.getElementById("tree-warning-label-2-270")
      ],
      despawnLabels: [
        document.getElementById("tree-despawn-label-2-0"),
        document.getElementById("tree-despawn-label-2-90"),
        document.getElementById("tree-despawn-label-2-180"),
        document.getElementById("tree-despawn-label-2-270")
      ],
      collected: false,
      hitBy: null
    },
    {
      id: 3,
      group: document.getElementById("tree-group-3"),
      model: document.getElementById("cartoon-tree-3"),
      probe: document.getElementById("tree-probe-3"),
      audio: document.getElementById("tree-audio-3"),
      warningLabels: [
        document.getElementById("tree-warning-label-3-0"),
        document.getElementById("tree-warning-label-3-90"),
        document.getElementById("tree-warning-label-3-180"),
        document.getElementById("tree-warning-label-3-270")
      ],
      despawnLabels: [
        document.getElementById("tree-despawn-label-3-0"),
        document.getElementById("tree-despawn-label-3-90"),
        document.getElementById("tree-despawn-label-3-180"),
        document.getElementById("tree-despawn-label-3-270")
      ],
      collected: false,
      hitBy: null
    },
    {
      id: 4,
      group: document.getElementById("tree-group-4"),
      model: document.getElementById("cartoon-tree-4"),
      probe: document.getElementById("tree-probe-4"),
      audio: document.getElementById("tree-audio-4"),
      warningLabels: [
        document.getElementById("tree-warning-label-4-0"),
        document.getElementById("tree-warning-label-4-90"),
        document.getElementById("tree-warning-label-4-180"),
        document.getElementById("tree-warning-label-4-270")
      ],
      despawnLabels: [
        document.getElementById("tree-despawn-label-4-0"),
        document.getElementById("tree-despawn-label-4-90"),
        document.getElementById("tree-despawn-label-4-180"),
        document.getElementById("tree-despawn-label-4-270")
      ],
      collected: false,
      hitBy: null
    },
    {
      id: 5,
      group: document.getElementById("tree-group-5"),
      model: document.getElementById("cartoon-tree-5"),
      probe: document.getElementById("tree-probe-5"),
      audio: document.getElementById("tree-audio-5"),
      warningLabels: [
        document.getElementById("tree-warning-label-5-0"),
        document.getElementById("tree-warning-label-5-90"),
        document.getElementById("tree-warning-label-5-180"),
        document.getElementById("tree-warning-label-5-270")
      ],
      despawnLabels: [
        document.getElementById("tree-despawn-label-5-0"),
        document.getElementById("tree-despawn-label-5-90"),
        document.getElementById("tree-despawn-label-5-180"),
        document.getElementById("tree-despawn-label-5-270")
      ],
      collected: false,
      hitBy: null
    },
    {
      id: 6,
      group: document.getElementById("tree-group-6"),
      model: document.getElementById("cartoon-tree-6"),
      probe: document.getElementById("tree-probe-6"),
      audio: document.getElementById("tree-audio-6"),
      warningLabels: [
        document.getElementById("tree-warning-label-6-0"),
        document.getElementById("tree-warning-label-6-90"),
        document.getElementById("tree-warning-label-6-180"),
        document.getElementById("tree-warning-label-6-270")
      ],
      despawnLabels: [
        document.getElementById("tree-despawn-label-6-0"),
        document.getElementById("tree-despawn-label-6-90"),
        document.getElementById("tree-despawn-label-6-180"),
        document.getElementById("tree-despawn-label-6-270")
      ],
      collected: false,
      hitBy: null
    },
    {
      id: 7,
      group: document.getElementById("tree-group-7"),
      model: document.getElementById("cartoon-tree-7"),
      probe: document.getElementById("tree-probe-7"),
      audio: document.getElementById("tree-audio-7"),
      warningLabels: [
        document.getElementById("tree-warning-label-7-0"),
        document.getElementById("tree-warning-label-7-90"),
        document.getElementById("tree-warning-label-7-180"),
        document.getElementById("tree-warning-label-7-270")
      ],
      despawnLabels: [
        document.getElementById("tree-despawn-label-7-0"),
        document.getElementById("tree-despawn-label-7-90"),
        document.getElementById("tree-despawn-label-7-180"),
        document.getElementById("tree-despawn-label-7-270")
      ],
      collected: false,
      hitBy: null
    }
  ];

  const playerTracker = document.getElementById("player-tracker");
  const labelsContainer = document.getElementById("player-labels-container");

  // Player audio management - for ALL players
  const playerAudioElements = new Map(); // connectionId -> car audio element
  const playerMusicElements = new Map(); // connectionId -> background music element
  const audioContainer = document.getElementById("player-audio-container");

  // Audio control function (similar to the restart function in your example)
  function restartTreeAudio(audioTag) {
    const currentTime = document.timeline.currentTime;
    const startTime = currentTime + 50; // Start 50ms in the future
    audioTag.setAttribute("start-time", startTime);
    audioTag.removeAttribute("pause-time");
    console.log(`Playing tree audio - Current time: ${currentTime}, Start time: ${startTime}`);
  }

  // Audio control function for car engines
  function restartPlayerAudio(audioTag) {
    const currentTime = document.timeline.currentTime;
    const startTime = currentTime + 50; // Start 50ms in the future
    audioTag.setAttribute("start-time", startTime);
    audioTag.removeAttribute("pause-time");
    console.log(`Starting car audio - Current time: ${currentTime}, Start time: ${startTime}`);
  }

  function stopPlayerAudio(audioTag) {
    const currentTime = document.timeline.currentTime;
    audioTag.setAttribute("pause-time", currentTime);
    audioTag.removeAttribute("start-time");
    console.log(`Stopping car audio at time: ${currentTime}`);
  }

  // Create or get audio element for a player
  function getOrCreatePlayerAudio(connectionId, position) {
    let audioElement = playerAudioElements.get(connectionId);
    if (audioElement) {
      // Update position
      audioElement.setAttribute("x", position.x);
      audioElement.setAttribute("y", position.y);
      audioElement.setAttribute("z", position.z);
      return audioElement;
    }
    
    // Create new audio element for this player
    audioElement = document.createElement("m-audio");
    audioElement.setAttribute("id", `player-car-audio-${connectionId}`);
    audioElement.setAttribute("src", "https://mmlstorage.com/e3a462277515e3d82c004b1def5387f564bbc5f744ac831ae97e0c45fdcd57a4");
    audioElement.setAttribute("volume", "0.4"); // Lower volume than tree audio
    audioElement.setAttribute("loop", "true");
    audioElement.setAttribute("enabled", "true");
    
    // Set initial position
    audioElement.setAttribute("x", position.x);
    audioElement.setAttribute("y", position.y);
    audioElement.setAttribute("z", position.z);
    
    // Add position smoothing
    const attributeLerp = document.createElement("m-attr-lerp");
    attributeLerp.setAttribute("attr", "all");
    attributeLerp.setAttribute("duration", "100");
    audioElement.appendChild(attributeLerp);
    
    audioContainer.appendChild(audioElement);
    playerAudioElements.set(connectionId, audioElement);
    
    // Start the audio
    restartPlayerAudio(audioElement);
    
    console.log(`Created car audio for player: ${connectionId}`);
    return audioElement;
  }

  // Create or get background music element for a player
  function getOrCreatePlayerMusic(connectionId, position) {
    let musicElement = playerMusicElements.get(connectionId);
    if (musicElement) {
      // Update position
      musicElement.setAttribute("x", position.x);
      musicElement.setAttribute("y", position.y);
      musicElement.setAttribute("z", position.z);
      return musicElement;
    }
    
    // Create new background music element for this player
    musicElement = document.createElement("m-audio");
    musicElement.setAttribute("id", `player-music-audio-${connectionId}`);
    musicElement.setAttribute("src", "https://mmlstorage.com/c857729f82e5ade637edfebfcc23b1743f6743099c73c4eecf92d058897b6349");
    musicElement.setAttribute("volume", "0.6");
    musicElement.setAttribute("loop", "true");
    musicElement.setAttribute("enabled", "true");
    
    // Set initial position
    musicElement.setAttribute("x", position.x);
    musicElement.setAttribute("y", position.y);
    musicElement.setAttribute("z", position.z);
    
    // Add position smoothing
    const attributeLerp = document.createElement("m-attr-lerp");
    attributeLerp.setAttribute("attr", "all");
    attributeLerp.setAttribute("duration", "100");
    musicElement.appendChild(attributeLerp);
    
    audioContainer.appendChild(musicElement);
    playerMusicElements.set(connectionId, musicElement);
    
    // Start the music
    restartPlayerAudio(musicElement);
    
    console.log(`Created background music for player: ${connectionId}`);
    return musicElement;
  }

  function clearPlayerAudio(connectionId) {
    // Clear car audio
    const audioElement = playerAudioElements.get(connectionId);
    if (audioElement) {
      console.log(`Removing car audio for player: ${connectionId}`);
      stopPlayerAudio(audioElement);
      audioElement.remove();
      playerAudioElements.delete(connectionId);
    }
    
    // Clear background music
    const musicElement = playerMusicElements.get(connectionId);
    if (musicElement) {
      console.log(`Removing background music for player: ${connectionId}`);
      stopPlayerAudio(musicElement);
      musicElement.remove();
      playerMusicElements.delete(connectionId);
    }
  }

  function setPlayerAudioPosition(connectionId, position) {
    // Create/update car audio
    const audioElement = getOrCreatePlayerAudio(connectionId, position);
    // Create/update background music
    const musicElement = getOrCreatePlayerMusic(connectionId, position);
    // Positions are already set in the respective functions
  }

  // Player label management - only for guilty players
  const connectedUsers = new Map(); // connectionId -> user object
  const guiltyPlayers = new Set(); // players who have hit trees and should show labels
  const playerShameTimers = new Map(); // connectionId -> timeout ID for clearing shame labels
  const labelColors = ["red", "blue", "green", "yellow", "purple", "orange", "pink", "cyan"];

  // Tree collision handling for multiple trees
  function handleTreeHit(tree, connectionId) {
    if (tree.collected) return; // Prevent multiple collections
    
    tree.collected = true;
    tree.hitBy = connectionId;
    console.log(`Tree ${tree.id} hit by player:`, connectionId);
    console.log(`Tree audio element:`, tree.audio);
    
    // Add player to guilty list (will show floating labels)
    guiltyPlayers.add(connectionId);
    
    // Clear any existing shame timer for this player and start a new one
    if (playerShameTimers.has(connectionId)) {
      clearTimeout(playerShameTimers.get(connectionId));
    }
    
    // Start new shame timer - labels will disappear 3 seconds after LAST tree hit
    const shameTimerId = setTimeout(() => {
      console.log(`Clearing shame labels for player: ${connectionId}`);
      guiltyPlayers.delete(connectionId);
      if (connectedUsers.has(connectionId)) {
        clearUser(connectionId);
      }
      playerShameTimers.delete(connectionId);
    }, 3000);
    
    playerShameTimers.set(connectionId, shameTimerId);
    
    // Remove the tree model
    const originalModelSrc = tree.model.getAttribute("src");
    const originalModelScale = {
      sx: tree.model.getAttribute("sx"),
      sy: tree.model.getAttribute("sy"),
      sz: tree.model.getAttribute("sz")
    };
    tree.model.removeAttribute("src");

    // Hide warning labels and show despawn labels
    tree.warningLabels.forEach(label => label.setAttribute("visible", "false"));
    tree.despawnLabels.forEach(label => label.setAttribute("visible", "true"));

    // Play tree despawn audio effect - right after RIP ENVIRONMENT labels appear
    if (tree.audio) {
      console.log(`RIP ENVIRONMENT labels now visible - playing audio for tree ${tree.id}`);
      console.log(`Audio element:`, tree.audio);
      console.log(`Timeline time:`, document.timeline.currentTime);
      restartTreeAudio(tree.audio);
    } else {
      console.log(`No audio element found for tree ${tree.id}`);
    }

    // Respawn tree after 10 seconds
    setTimeout(() => {
      console.log(`Tree ${tree.id} respawning...`);
      
      tree.collected = false;
      tree.hitBy = null;
      
      // Restore the tree model
      tree.model.setAttribute("src", originalModelSrc);
      tree.model.setAttribute("sx", originalModelScale.sx);
      tree.model.setAttribute("sy", originalModelScale.sy);
      tree.model.setAttribute("sz", originalModelScale.sz);

      // Show warning labels and hide despawn labels
      tree.warningLabels.forEach(label => label.setAttribute("visible", "true"));
      tree.despawnLabels.forEach(label => label.setAttribute("visible", "false"));
    }, 10000);
  }

  // Debug: Check if all tree elements are found
  trees.forEach(tree => {
    console.log(`Tree ${tree.id} - Model:`, tree.model, `Probe:`, tree.probe, `Audio:`, tree.audio);
  });

  // Set up event listeners for all trees
  trees.forEach(tree => {
    tree.probe.addEventListener("positionenter", (event) => {
      handleTreeHit(tree, event.detail.connectionId);
    });
  });

  // Player label management - only for guilty players
  function getOrCreateUser(connectionId, position, rotation) {
    // Only create labels for guilty players (who have hit trees)
    if (!guiltyPlayers.has(connectionId)) return null;
    
    const user = connectedUsers.get(connectionId);
    if (user) {
      user.position = position;
      user.rotation = rotation;
      return user;
    }
    
    // Create first label element (0 degrees) - "CLIMATE DESTROYER" label
    const userLabel1 = document.createElement("m-label");
    userLabel1.setAttribute("content", "CLIMATE CHANGER");
    userLabel1.setAttribute("font-size", "40");
    userLabel1.setAttribute("font-color", "red");
    userLabel1.setAttribute("alignment", "center");
    userLabel1.setAttribute("width", "4");
    userLabel1.setAttribute("height", "0.8");
    userLabel1.setAttribute("collide", "false");
    userLabel1.setAttribute("visible", "true");
    userLabel1.setAttribute("emissive", "0.5");
    userLabel1.setAttribute("color", "rgb(0,0,0)");
    userLabel1.setAttribute("ry", "0");
    
    // Add smooth position animation to first label
    const attributeLerp1 = document.createElement("m-attr-lerp");
    attributeLerp1.setAttribute("attr", "all");
    attributeLerp1.setAttribute("duration", "100");
    userLabel1.appendChild(attributeLerp1);
    
    // Add rotation animation to first label
    const rotationAnim1 = document.createElement("m-attr-anim");
    rotationAnim1.setAttribute("attr", "ry");
    rotationAnim1.setAttribute("start-value", "0");
    rotationAnim1.setAttribute("end-value", "360");
    rotationAnim1.setAttribute("duration", "8000");
    rotationAnim1.setAttribute("loop", "true");
    rotationAnim1.setAttribute("easing", "linear");
    userLabel1.appendChild(rotationAnim1);
    
    // Create second label element (180 degrees rotated)
    const userLabel2 = document.createElement("m-label");
    userLabel2.setAttribute("content", "CLIMATE CHANGER");
    userLabel2.setAttribute("font-size", "40");
    userLabel2.setAttribute("font-color", "red");
    userLabel2.setAttribute("alignment", "center");
    userLabel2.setAttribute("width", "4");
    userLabel2.setAttribute("height", "0.8");
    userLabel2.setAttribute("collide", "false");
    userLabel2.setAttribute("visible", "true");
    userLabel2.setAttribute("emissive", "0.5");
    userLabel2.setAttribute("color", "rgb(0,0,0)");
    userLabel2.setAttribute("ry", "180");
    
    // Add smooth position animation to second label
    const attributeLerp2 = document.createElement("m-attr-lerp");
    attributeLerp2.setAttribute("attr", "all");
    attributeLerp2.setAttribute("duration", "100");
    userLabel2.appendChild(attributeLerp2);
    
    // Add rotation animation to second label
    const rotationAnim2 = document.createElement("m-attr-anim");
    rotationAnim2.setAttribute("attr", "ry");
    rotationAnim2.setAttribute("start-value", "180");
    rotationAnim2.setAttribute("end-value", "540");
    rotationAnim2.setAttribute("duration", "8000");
    rotationAnim2.setAttribute("loop", "true");
    rotationAnim2.setAttribute("easing", "linear");
    userLabel2.appendChild(rotationAnim2);
    
    labelsContainer.appendChild(userLabel1);
    labelsContainer.appendChild(userLabel2);
    
    const newUser = {
      label1: userLabel1,
      label2: userLabel2,
      position,
      rotation,
    };
    connectedUsers.set(connectionId, newUser);
    return newUser;
  }
  
  function clearUser(connectionId) {
    const user = connectedUsers.get(connectionId);
    if (!user) return;
    user.label1.remove();
    user.label2.remove();
    connectedUsers.delete(connectionId);
  }
  
  function setLabelPosition(connectionId, position, rotation) {
    // Only show labels for guilty players
    if (!guiltyPlayers.has(connectionId)) return;
    
    const user = getOrCreateUser(connectionId, position, rotation);
    if (!user) return;
    
    // Position both labels at the same location
    user.label1.setAttribute("x", position.x);
    user.label1.setAttribute("y", position.y + 2); // 2 meters above player
    user.label1.setAttribute("z", position.z);
    
    user.label2.setAttribute("x", position.x);
    user.label2.setAttribute("y", position.y + 2); // 2 meters above player
    user.label2.setAttribute("z", position.z);
  }

  // Player tracking event listeners - improved implementation
  window.addEventListener("disconnected", (event) => {
    const { connectionId } = event.detail;
    
    // Clear shame timer if it exists
    if (playerShameTimers.has(connectionId)) {
      clearTimeout(playerShameTimers.get(connectionId));
      playerShameTimers.delete(connectionId);
    }
    
    guiltyPlayers.delete(connectionId);
    clearUser(connectionId);
    
    // Clear player audio
    clearPlayerAudio(connectionId);
  });

  playerTracker.addEventListener("positionenter", (event) => {
    const { connectionId, elementRelative, documentRelative } = event.detail;
    console.log("Player entered tracking area:", connectionId);
    
    // Update shame labels (only for guilty players)
    setLabelPosition(connectionId, elementRelative.position, elementRelative.rotation);
    
    // Update car audio (for all players)
    setPlayerAudioPosition(connectionId, elementRelative.position);
  });

  playerTracker.addEventListener("positionmove", (event) => {
    const { connectionId, elementRelative, documentRelative } = event.detail;
    /*
       It's possible to receive an update without an explicit enter event if this user is already in the range of
       this element when the document is reloaded. In this case, we need to create the user as if this is an
       enter event.
      */
    
    // Update shame labels (only for guilty players)
    setLabelPosition(connectionId, elementRelative.position, elementRelative.rotation);
    
    // Update car audio (for all players)
    setPlayerAudioPosition(connectionId, elementRelative.position);
  });

  playerTracker.addEventListener("positionleave", (event) => {
    const { connectionId } = event.detail;
    console.log("Player left tracking area:", connectionId);
    
    // Clear shame labels
    clearUser(connectionId);
    
    // Clear car audio
    clearPlayerAudio(connectionId);
  });

  // Debug elements removed for clean racing environment
</script>
